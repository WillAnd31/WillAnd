<div class="blog">
	<h1>Blog</h1>
	
    
    <h2>Easy SSL Setup With Let's Encrypt</h2>
    <h3>Will Anderson - 20 Feb 2016</h3>

    <p>Setting up SSL for your website is a peace of cake with <a href="https://letsencrypt.org/">Let's Encrypt</a>! Setting up SSL for this website took me a total of 5 minutes, of course this website is super slim because I use it to test doing stuff in NodeJs. This website is so slim that the server.js file has been just a few lines of code. Let's get right to it!</p>

    <p>I am running this website off of an Amazon Web Service's EC2 instance, the highest tier of an EC2 instance allowed before it isn't free anymore. On that instance I am running Ubuntu 14 and serving this website with NodeJs. There are only four NPM packages needed for serve your website over SSL: <code>letsencrypt</code>, <code>fs</code>, <code>http</code>, <code>https</code>. Also I had to install <code>letsencrypt-cli</code> with NPM. After installing those packages you need to get your key and certificate from Let's Encrypt. You can do this by running: <br><br><code>letsencrypt certonly --agree-tos --email 'your-email-here' --standalone --domains 'your-domain-name-here' --config-dir 'where-you-want-keys' --server https://acme-staging.api.letsencrypt.org/directory</code><br><br> this will create the keys and certs that you need. You can specify where Let's Encrypt saves those <code>.pem</code> files. I ran this command as root and saved them here: <code>/letsencrypt/etc/live/willand.co/*.pem</code>.</p>
    
    <p>Now that you have the keys and certs necessary for SSL you need to set up your <code>server.js</code> file to serve your files over SSL. Here is an example of my <code>server.js</code> file:</p>
    
    <pre><code>
        var express = require('express');
        var app = express();
        var morgan = require('morgan');
        var http = require('http');
        var https = require('https');
        var fs = require('fs');

        var keyPem;
        var certPem;

        var httpPort;
        var httpsPort;

        if (process.env.NODE_ENV === 'server') {
            keyPem = fs.readFileSync('../../../letsencrypt/etc/live/willand.co/privkey.pem', 'utf8');
            certPem = fs.readFileSync('../../../../letsencrypt/etc/live/willand.co/cert.pem', 'utf8');
            httpPort = 80;
            httpsPort = 443;
        } else {
            httpPort = 8888;
            httpsPort = 8890;
        }

        app.use(morgan('dev'));
        app.use(express.static(__dirname + '/www'));

        http.createServer(app).listen(httpPort);
        https.createServer({
            key: keyPem,
            cert: certPem
        }, app).listen(httpsPort);

        app.get('*', function(req, res, next) {
            res.sendFile('./www/index.html', { root: __dirname });
        });

        console.log('Running on http port: ' + httpPort);
        console.log('Running on https port: ' + httpsPort);
    </code></pre>
    
    <p>Keep in mind that I am only serving my AngularJS app with this file so there's nothing special going on. Basically I'm using <code>fs</code> to read the private key and certificate into the variables <code>keyPem</code> and <code>certPem</code>, from there I am checking the environment variable NODE_ENV to determine if the file should get the private key and cert and serve my AngularJS app over port 80 (default port for HTTP) and 443 (default port for HTTPS) or just run the AngularJS app through localhost. Then with <code>http.createServer</code> and <code>https.createServer</code> Express is creating a listener over the HTTP and HTTPS ports.<br><br>That's it! Let's Encrypt makes it super easy to serve your website over SSL.<br><br><br></p>
    
</div>